classdef ShapeFunctionL16 < ShapeFunctions2D
    methods
        function obj = ShapeFunctionL16() 
            obj=obj@ShapeFunctions2D()
            obj.localNodes = [-1 -1/3 1/3 1 -1   -1/3  1/3  1    -1 -1/3 1/3 1   -1 -1/3 1/3 1; ...
                              -1 -1  -1   1 -1/3 -1/3 -1/3 -1/3  1/3 1/3 1/3 1/3  1   1   1  1]';
            obj.vertices=[1 4 13 16]';
            obj.edges = [1 2 3 4; 4 8 12 16; 16 15 14 13; 13 9 5 1]';
            obj.contour = [1 2 3 4 8 12 16 15 14 13 9 5 1];
            obj.edgesf = ShapeFunctionL4l;
            obj.pattern = [ 0 1 2 3 0 1 2 3 0 1 2 3 0 1 2 3; 0 0 0 0 1 1 1 1 2 2 2 2 3 3 3 3]';
        end
        function value = computeValue( ~, xi )
            x = xi(:,1);
            y = xi(:,2);
            value = [  ((1-x).*(3*x-1).*(3*x+1).*(1-y).*(3*y-1).*(3*y+1))/256 ...
                        (9*(x-1).*(x+1).*(3*x-1).*(1-y).*(3*y-1).*(3*y+1))/256 ...
                        -(9*(x-1).*(x+1).*(3*x+1).*(1-y).*(3*y-1).*(3*y+1))/256 ...
                        ((x+1).*(3*x-1).*(3*x+1).*(1-y).*(3*y-1).*(3*y+1))/256 ...
                        (9*(1-x).*(3*x-1).*(3*x+1).*(y-1).*(y+1).*(3*y-1))/256 ...
                        (81*(x-1).*(x+1).*(3*x-1).*(y-1).*(y+1).*(3*y-1))/256 ...
                        -(81*(x-1).*(x+1).*(3*x+1).*(y-1).*(y+1).*(3*y-1))/256 ...
                         (9*(x+1).*(3*x-1).*(3*x+1).*(y-1).*(y+1).*(3*y-1))/256 ...
                         -(9*(1-x).*(3*x-1).*(3*x+1).*(y-1).*(y+1).*(3*y+1))/256 ...
                         -(81*(x-1).*(x+1).*(3*x-1).*(y-1).*(y+1).*(3*y+1))/256 ...
                          (81*(x-1).*(x+1).*(3*x+1).*(y-1).*(y+1).*(3*y+1))/256 ...
                         -(9*(x+1).*(3*x-1).*(3*x+1).*(y-1).*(y+1).*(3*y+1))/256 ...
                         ((1-x).*(3*x-1).*(3*x+1).*(y+1).*(3*y-1).*(3*y+1))/256 ...
                         (9*(x-1).*(x+1).*(3*x-1).*(y+1).*(3*y-1).*(3*y+1))/256 ...
                         -(9*(x-1).*(x+1).*(3*x+1).*(y+1).*(3*y-1).*(3*y+1))/256 ...
                         ((x+1).*(3*x-1).*(3*x+1).*(y+1).*(3*y-1).*(3*y+1))/256 ];
        end
        function grad = computeGradient( ~, xi )
            x  = xi(:,1);
            y  = xi(:,2);
            grad = zeros( 16, 2, size( xi, 1 ) );
                     
            xx = x.*x;
            yy = y.*y;
            
            grad(1,1,:) =  ((27*xx-18*x-1).*(y-1).*(3*y-1).*(3*y+1))/256;
            grad(2,1,:) = -(9*(9*xx-2*x-3).*(y-1).*(3*y-1).*(3*y+1))/256;
            grad(3,1,:) = (9*(9*xx+2*x-3).*(y-1).*(3*y-1).*(3*y+1))/256;
            grad(4,1,:) = -((27*xx+18*x-1).*(y-1).*(3*y-1).*(3*y+1))/256;
            grad(5,1,:) = -(9*(27*xx-18*x-1).*(y-1).*(y+1).*(3*y-1))/256;
            grad(6,1,:) = (81*(9*xx-2*x-3).*(y-1).*(y+1).*(3*y-1))/256;
            grad(7,1,:) = -(81*(9*xx+2*x-3).*(y-1).*(y+1).*(3*y-1))/256;
            grad(8,1,:) = (9*(27*xx+18*x-1).*(y-1).*(y+1).*(3*y-1))/256;
            grad(9,1,:) = (9*(27*xx-18*x-1).*(y-1).*(y+1).*(3*y+1))/256;
            grad(10,1,:) = -(81*(9*xx-2*x-3).*(y-1).*(y+1).*(3*y+1))/256;
            grad(11,1,:) = (81*(9*xx+2*x-3).*(y-1).*(y+1).*(3*y+1))/256;
            grad(12,1,:) = -(9*(27*xx+18*x-1).*(y-1).*(y+1).*(3*y+1))/256;
            grad(13,1,:) = -((27*xx-18*x-1).*(y+1).*(3*y-1).*(3*y+1))/256;
            grad(14,1,:) = (9*(9*xx-2*x-3).*(y+1).*(3*y-1).*(3*y+1))/256;
            grad(15,1,:) = -(9*(9*xx+2*x-3).*(y+1).*(3*y-1).*(3*y+1))/256;
            grad(16,1,:) = ((27*xx+18*x-1).*(y+1).*(3*y-1).*(3*y+1))/256;

            grad(1,2,:)  =((x-1).*(3*x-1).*(3*x+1).*(27*yy-18*y-1))/256;
            grad(2,2,:)  =-(9*(x-1).*(x+1).*(3*x-1).*(27*yy-18*y-1))/256;
            grad(3,2,:)  =(9*(x-1).*(x+1).*(3*x+1).*(27*yy-18*y-1))/256;
            grad(4,2,:)  =-((x+1).*(3*x-1).*(3*x+1).*(27*yy-18*y-1))/256;
            grad(5,2,:)  =-(9*(x-1).*(3*x-1).*(3*x+1).*(9*yy-2*y-3))/256;
            grad(6,2,:)  =(81*(x-1).*(x+1).*(3*x-1).*(9*yy-2*y-3))/256;
            grad(7,2,:)  =-(81*(x-1).*(x+1).*(3*x+1).*(9*yy-2*y-3))/256;
            grad(8,2,:)  =(9*(x+1).*(3*x-1).*(3*x+1).*(9*yy-2*y-3))/256;
            grad(9,2,:)  =(9*(x-1).*(3*x-1).*(3*x+1).*(9*yy+2*y-3))/256;
            grad(10,2,:)  =-(81*(x-1).*(x+1).*(3*x-1).*(9*yy+2*y-3))/256;
            grad(11,2,:) =(81*(x-1).*(x+1).*(3*x+1).*(9*yy+2*y-3))/256;
            grad(12,2,:) =-(9*(x+1).*(3*x-1).*(3*x+1).*(9*yy+2*y-3))/256;
            grad(13,2,:) =-((x-1).*(3*x-1).*(3*x+1).*(27*yy+18*y-1))/256;
            grad(14,2,:) =(9*(x-1).*(x+1).*(3*x-1).*(27*yy+18*y-1))/256;
            grad(15,2,:) =-(9*(x-1).*(x+1).*(3*x+1).*(27*yy+18*y-1))/256;
            grad(16,2,:) =((x+1).*(3*x-1).*(3*x+1).*(27*yy+18*y-1))/256;

        end
        function integrator = createIntegrator(varargin)
            integrator = IntegrationRectangular(3,2);
        end
    end
end 
