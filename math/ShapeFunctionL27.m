classdef ShapeFunctionL27 < ShapeFunctions3D
    methods
        function obj = ShapeFunctionL27() 
            
%            m_corners = { 0, 2, 6, 8, 18, 20, 24, 26 };
  %          m_edges   = { {0,1,2}, {6,7,8}, {18,19,20}, {24,25,26}, {0,3,6}, {2,5,8}, {18,21,24}, {20,23,26}, {0,9,18}, {2,11,20}, {6,15,24}, {8,17,26} };
%            m_faces   = { {6,4,0,15,12,9,24,21,18}, {2,5,8,11,16,17,20,23,26}, {0,1,2,9,10,11,18,19,20}, {8,7,6,17,16,15,26,25,24} };
            
            obj.localNodes = [-1 -1 -1; 0 -1 -1; 1 -1 -1; -1 0 -1; 0 0 -1; 1 0 -1; -1 1 -1; 0 1 -1; 1 1 -1; ...
                              -1 -1  0; 0 -1  0; 1 -1  0; -1 0  0; 0 0  0; 1 0  0; -1 1  0; 0 1  0; 1 1  0; ...
                              -1 -1  1; 0 -1  1; 1 -1  1; -1 0  1; 0 0  1; 1 0  1; -1 1  1; 0 1  1; 1 1  1];
            obj.vertices = [ 1, 3, 7, 8, 19, 21, 25, 27 ]';
            obj.edges    = [ 1,2,3; 7,8,9; 19,20,21; 25,26,27; 1,4,7; 3,6,9; 19,22,25; 21,24,27; 1,10,19; 3,12,21; 7,16,25; 9,18,27 ]';
            obj.edgesf = ShapeFunctionL3;
            obj.faces    = [ 7,4,1,16,13,10,25,22,19; 3,6,9,12,15,18,21,24,27; 1,2,3,10,11,12,19,20,21; 9,8,7,18,17,16,27,26,25; 7,8,9,4,5,6,1,2,3; 19,20,21,22,23,24,25,26,27 ]';
            obj.fcontours    = [ 1,2,3,12,21,20,19,10; 3,6,9,18,27,24,21,12; 9,8,7,16,25,26,27,18; 7,4,1,10,19,22,25,16; 7,8,9,6,3,2,1,4; 19,20,21,24,27,26,25,22 ]';
            obj.facesf = ShapeFunctionL9;
            obj.pattern = [ 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2; 
                            0 0 0 1 1 1 2 2 2 0 0 0 1 1 1 2 2 2 0 0 0 1 1 1 2 2 2; 
                            0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 ]';
        end
        function value = computeValue( ~, xi )
            x = xi(:,1);
            y = xi(:,2);
            z = xi(:,3);
            value = [ ((x-1).*x.*(y-1).*y.*(z-1).*z)/8 ((1-x.^2).*(y-1).*y.*(z-1).*z)/4 (x.*(x+1).*(y-1).*y.*(z-1).*z)/8 ((x-1).*x.*(1-y.^2).*(z-1).*z)/4 ((1-x.^2).*(1-y.^2).*(z-1).*z)/2 (x.*(x+1).*(1-y.^2).*(z-1).*z)/4 ...
                       ((x-1).*x.*y.*(y+1).*(z-1).*z)/8 ((1-x.^2).*y.*(y+1).*(z-1).*z)/4 (x.*(x+1).*y.*(y+1).*(z-1).*z)/8 ((x-1).*x.*(y-1).*y.*(1-z.^2))/4 ((1-x.^2).*(y-1).*y.*(1-z.^2))/2 (x.*(x+1).*(y-1).*y.*(1-z.^2))/4 ...
                        ((x-1).*x.*(1-y.^2).*(1-z.^2))/2 (1-x.^2).*(1-y.^2).*(1-z.^2) (x.*(x+1).*(1-y.^2).*(1-z.^2))/2 ((x-1).*x.*y.*(y+1).*(1-z.^2))/4 ((1-x.^2).*y.*(y+1).*(1-z.^2))/2 (x.*(x+1).*y.*(y+1).*(1-z.^2))/4 ...
                        ((x-1).*x.*(y-1).*y.*z.*(z+1))/8 ((1-x.^2).*(y-1).*y.*z.*(z+1))/4 (x.*(x+1).*(y-1).*y.*z.*(z+1))/8 ((x-1).*x.*(1-y.^2).*z.*(z+1))/4 ((1-x.^2).*(1-y.^2).*z.*(z+1))/2 (x.*(x+1).*(1-y.^2).*z.*(z+1))/4 ...
                        ((x-1).*x.*y.*(y+1).*z.*(z+1))/8 ((1-x.^2).*y.*(y+1).*z.*(z+1))/4 (x.*(x+1).*y.*(y+1).*z.*(z+1))/8 ];
        end
        function grad = computeGradient( ~, xi )
             x  = xi(:,1);
             y  = xi(:,2);
             z  = xi(:,3);
             grad = zeros( 27, 3, size( xi, 1 ) );
                          
             grad(1,1,:)  =  (x.*(y-1).*y.*(z-1).*z)/8+((x-1).*(y-1).*y.*(z-1).*z)/8;
             grad(2,1,:)  =  (-((x+1).*(y-1).*y.*(z-1).*z)/4)-((x-1).*(y-1).*y.*(z-1).*z)/4;
             grad(3,1,:)  =  ((x+1).*(y-1).*y.*(z-1).*z)/8+(x.*(y-1).*y.*(z-1).*z)/8;
             grad(4,1,:)  =  (-(x.*(y-1).*(y+1).*(z-1).*z)/4)-((x-1).*(y-1).*(y+1).*(z-1).*z)/4;
             grad(5,1,:)  =  ((x+1).*(y-1).*(y+1).*(z-1).*z)/2+((x-1).*(y-1).*(y+1).*(z-1).*z)/2;
             grad(6,1,:)  =  (-((x+1).*(y-1).*(y+1).*(z-1).*z)/4)-(x.*(y-1).*(y+1).*(z-1).*z)/4;
             grad(7,1,:)  =  (x.*y.*(y+1).*(z-1).*z)/8+((x-1).*y.*(y+1).*(z-1).*z)/8;
             grad(8,1,:)  =  (-((x+1).*y.*(y+1).*(z-1).*z)/4)-((x-1).*y.*(y+1).*(z-1).*z)/4;
             grad(9,1,:)  =  ((x+1).*y.*(y+1).*(z-1).*z)/8+(x.*y.*(y+1).*(z-1).*z)/8;
             grad(10,1,:)  =  (-(x.*(y-1).*y.*(z-1).*(z+1))/4)-((x-1).*(y-1).*y.*(z-1).*(z+1))/4;
             grad(11,1,:)  =  ((x+1).*(y-1).*y.*(z-1).*(z+1))/2+((x-1).*(y-1).*y.*(z-1).*(z+1))/2;
             grad(12,1,:)  =  (-((x+1).*(y-1).*y.*(z-1).*(z+1))/4)-(x.*(y-1).*y.*(z-1).*(z+1))/4;
             grad(13,1,:)  =  (x.*(y-1).*(y+1).*(z-1).*(z+1))/2+((x-1).*(y-1).*(y+1).*(z-1).*(z+1))/2;
             grad(14,1,:)  =  (-(x+1).*(y-1).*(y+1).*(z-1).*(z+1))-(x-1).*(y-1).*(y+1).*(z-1).*(z+1);
             grad(15,1,:)  =  ((x+1).*(y-1).*(y+1).*(z-1).*(z+1))/2+(x.*(y-1).*(y+1).*(z-1).*(z+1))/2;
             grad(16,1,:)  =  (-(x.*y.*(y+1).*(z-1).*(z+1))/4)-((x-1).*y.*(y+1).*(z-1).*(z+1))/4;
             grad(17,1,:)  =  ((x+1).*y.*(y+1).*(z-1).*(z+1))/2+((x-1).*y.*(y+1).*(z-1).*(z+1))/2;
             grad(18,1,:)  =  (-((x+1).*y.*(y+1).*(z-1).*(z+1))/4)-(x.*y.*(y+1).*(z-1).*(z+1))/4;
             grad(19,1,:)  =  (x.*(y-1).*y.*z.*(z+1))/8+((x-1).*(y-1).*y.*z.*(z+1))/8;
             grad(20,1,:)  =  (-((x+1).*(y-1).*y.*z.*(z+1))/4)-((x-1).*(y-1).*y.*z.*(z+1))/4;
             grad(21,1,:)  =  ((x+1).*(y-1).*y.*z.*(z+1))/8+(x.*(y-1).*y.*z.*(z+1))/8;
             grad(22,1,:)  =  (-(x.*(y-1).*(y+1).*z.*(z+1))/4)-((x-1).*(y-1).*(y+1).*z.*(z+1))/4;
             grad(23,1,:)  =  ((x+1).*(y-1).*(y+1).*z.*(z+1))/2+((x-1).*(y-1).*(y+1).*z.*(z+1))/2;
             grad(24,1,:)  =  (-((x+1).*(y-1).*(y+1).*z.*(z+1))/4)-(x.*(y-1).*(y+1).*z.*(z+1))/4;
             grad(25,1,:)  =  (x.*y.*(y+1).*z.*(z+1))/8+((x-1).*y.*(y+1).*z.*(z+1))/8;
             grad(26,1,:)  =  (-((x+1).*y.*(y+1).*z.*(z+1))/4)-((x-1).*y.*(y+1).*z.*(z+1))/4;
             grad(27,1,:)  =  ((x+1).*y.*(y+1).*z.*(z+1))/8+(x.*y.*(y+1).*z.*(z+1))/8;
             
             
             grad(1,2,:) = ((x-1).*x.*y.*(z-1).*z)/8+((x-1).*x.*(y-1).*(z-1).*z)/8;
             grad(2,2,:) = (-((x-1).*(x+1).*y.*(z-1).*z)/4)-((x-1).*(x+1).*(y-1).*(z-1).*z)/4;
             grad(3,2,:) = (x.*(x+1).*y.*(z-1).*z)/8+(x.*(x+1).*(y-1).*(z-1).*z)/8;
             grad(4,2,:) = (-((x-1).*x.*(y+1).*(z-1).*z)/4)-((x-1).*x.*(y-1).*(z-1).*z)/4;
             grad(5,2,:) = ((x-1).*(x+1).*(y+1).*(z-1).*z)/2+((x-1).*(x+1).*(y-1).*(z-1).*z)/2;
             grad(6,2,:) = (-(x.*(x+1).*(y+1).*(z-1).*z)/4)-(x.*(x+1).*(y-1).*(z-1).*z)/4;
             grad(7,2,:) = ((x-1).*x.*(y+1).*(z-1).*z)/8+((x-1).*x.*y.*(z-1).*z)/8;
             grad(8,2,:) = (-((x-1).*(x+1).*(y+1).*(z-1).*z)/4)-((x-1).*(x+1).*y.*(z-1).*z)/4;
             grad(9,2,:) = (x.*(x+1).*(y+1).*(z-1).*z)/8+(x.*(x+1).*y.*(z-1).*z)/8;
             grad(10,2,:) = (-((x-1).*x.*y.*(z-1).*(z+1))/4)-((x-1).*x.*(y-1).*(z-1).*(z+1))/4;
             grad(11,2,:) = ((x-1).*(x+1).*y.*(z-1).*(z+1))/2+((x-1).*(x+1).*(y-1).*(z-1).*(z+1))/2;
             grad(12,2,:) = (-(x.*(x+1).*y.*(z-1).*(z+1))/4)-(x.*(x+1).*(y-1).*(z-1).*(z+1))/4;
             grad(13,2,:) = ((x-1).*x.*(y+1).*(z-1).*(z+1))/2+((x-1).*x.*(y-1).*(z-1).*(z+1))/2;
             grad(14,2,:) = (-(x-1).*(x+1).*(y+1).*(z-1).*(z+1))-(x-1).*(x+1).*(y-1).*(z-1).*(z+1);
             grad(15,2,:) = (x.*(x+1).*(y+1).*(z-1).*(z+1))/2+(x.*(x+1).*(y-1).*(z-1).*(z+1))/2;
             grad(16,2,:) = (-((x-1).*x.*(y+1).*(z-1).*(z+1))/4)-((x-1).*x.*y.*(z-1).*(z+1))/4;
             grad(17,2,:) = ((x-1).*(x+1).*(y+1).*(z-1).*(z+1))/2+((x-1).*(x+1).*y.*(z-1).*(z+1))/2;
             grad(18,2,:) = (-(x.*(x+1).*(y+1).*(z-1).*(z+1))/4)-(x.*(x+1).*y.*(z-1).*(z+1))/4;
             grad(19,2,:) = ((x-1).*x.*y.*z.*(z+1))/8+((x-1).*x.*(y-1).*z.*(z+1))/8;
             grad(20,2,:) = (-((x-1).*(x+1).*y.*z.*(z+1))/4)-((x-1).*(x+1).*(y-1).*z.*(z+1))/4;
             grad(21,2,:) = (x.*(x+1).*y.*z.*(z+1))/8+(x.*(x+1).*(y-1).*z.*(z+1))/8;
             grad(22,2,:) = (-((x-1).*x.*(y+1).*z.*(z+1))/4)-((x-1).*x.*(y-1).*z.*(z+1))/4;
             grad(23,2,:) = ((x-1).*(x+1).*(y+1).*z.*(z+1))/2+((x-1).*(x+1).*(y-1).*z.*(z+1))/2;
             grad(24,2,:) = (-(x.*(x+1).*(y+1).*z.*(z+1))/4)-(x.*(x+1).*(y-1).*z.*(z+1))/4;
             grad(25,2,:) = ((x-1).*x.*(y+1).*z.*(z+1))/8+((x-1).*x.*y.*z.*(z+1))/8;
             grad(26,2,:) = (-((x-1).*(x+1).*(y+1).*z.*(z+1))/4)-((x-1).*(x+1).*y.*z.*(z+1))/4;
             grad(27,2,:) = (x.*(x+1).*(y+1).*z.*(z+1))/8+(x.*(x+1).*y.*z.*(z+1))/8;

                
             grad(1,3,:)  =  ((x-1).*x.*(y-1).*y.*z)/8+((x-1).*x.*(y-1).*y.*(z-1))/8;
             grad(2,3,:)  =  (-((x-1).*(x+1).*(y-1).*y.*z)/4)-((x-1).*(x+1).*(y-1).*y.*(z-1))/4;
             grad(3,3,:)  =   (x.*(x+1).*(y-1).*y.*z)/8+(x.*(x+1).*(y-1).*y.*(z-1))/8;
             grad(4,3,:)  =   (-((x-1).*x.*(y-1).*(y+1).*z)/4)-((x-1).*x.*(y-1).*(y+1).*(z-1))/4;
             grad(5,3,:)  =   ((x-1).*(x+1).*(y-1).*(y+1).*z)/2+((x-1).*(x+1).*(y-1).*(y+1).*(z-1))/2;
             grad(6,3,:)  =   (-(x.*(x+1).*(y-1).*(y+1).*z)/4)-(x.*(x+1).*(y-1).*(y+1).*(z-1))/4;
             grad(7,3,:)  =   ((x-1).*x.*y.*(y+1).*z)/8+((x-1).*x.*y.*(y+1).*(z-1))/8;
             grad(8,3,:)  =   (-((x-1).*(x+1).*y.*(y+1).*z)/4)-((x-1).*(x+1).*y.*(y+1).*(z-1))/4;
             grad(9,3,:)  =   (x.*(x+1).*y.*(y+1).*z)/8+(x.*(x+1).*y.*(y+1).*(z-1))/8;
             grad(10,3,:)  =   (-((x-1).*x.*(y-1).*y.*(z+1))/4)-((x-1).*x.*(y-1).*y.*(z-1))/4;
             grad(11,3,:)  =   ((x-1).*(x+1).*(y-1).*y.*(z+1))/2+((x-1).*(x+1).*(y-1).*y.*(z-1))/2;
             grad(12,3,:)  =   (-(x.*(x+1).*(y-1).*y.*(z+1))/4)-(x.*(x+1).*(y-1).*y.*(z-1))/4;
             grad(13,3,:)  =   ((x-1).*x.*(y-1).*(y+1).*(z+1))/2+((x-1).*x.*(y-1).*(y+1).*(z-1))/2;
             grad(14,3,:)  =   (-(x-1).*(x+1).*(y-1).*(y+1).*(z+1))-(x-1).*(x+1).*(y-1).*(y+1).*(z-1);
             grad(15,3,:)  =   (x.*(x+1).*(y-1).*(y+1).*(z+1))/2+(x.*(x+1).*(y-1).*(y+1).*(z-1))/2;
             grad(16,3,:)  =   (-((x-1).*x.*y.*(y+1).*(z+1))/4)-((x-1).*x.*y.*(y+1).*(z-1))/4;
             grad(17,3,:)  =   ((x-1).*(x+1).*y.*(y+1).*(z+1))/2+((x-1).*(x+1).*y.*(y+1).*(z-1))/2;
             grad(18,3,:)  =   (-(x.*(x+1).*y.*(y+1).*(z+1))/4)-(x.*(x+1).*y.*(y+1).*(z-1))/4;
             grad(19,3,:)  =   ((x-1).*x.*(y-1).*y.*(z+1))/8+((x-1).*x.*(y-1).*y.*z)/8;
             grad(20,3,:)  =   (-((x-1).*(x+1).*(y-1).*y.*(z+1))/4)-((x-1).*(x+1).*(y-1).*y.*z)/4;
             grad(21,3,:)  =   (x.*(x+1).*(y-1).*y.*(z+1))/8+(x.*(x+1).*(y-1).*y.*z)/8;
             grad(22,3,:)  =   (-((x-1).*x.*(y-1).*(y+1).*(z+1))/4)-((x-1).*x.*(y-1).*(y+1).*z)/4;
             grad(23,3,:)  =   ((x-1).*(x+1).*(y-1).*(y+1).*(z+1))/2+((x-1).*(x+1).*(y-1).*(y+1).*z)/2;
             grad(24,3,:)  =   (-(x.*(x+1).*(y-1).*(y+1).*(z+1))/4)-(x.*(x+1).*(y-1).*(y+1).*z)/4;
             grad(25,3,:)  =   ((x-1).*x.*y.*(y+1).*(z+1))/8+((x-1).*x.*y.*(y+1).*z)/8;
             grad(26,3,:)  =   (-((x-1).*(x+1).*y.*(y+1).*(z+1))/4)-((x-1).*(x+1).*y.*(y+1).*z)/4;
             grad(27,3,:)  =  (x.*(x+1).*y.*(y+1).*(z+1))/8+(x.*(x+1).*y.*(y+1).*z)/8;
             
        end
        function integrator = createIntegrator(varargin)
            integrator = IntegrationRectangular(2,3);
        end
    end
end 
